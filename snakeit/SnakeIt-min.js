var canvas,context,snake={tail:[{x:3,y:2,direction:"H"},{x:2,y:2,direction:"D2R"},{x:2,y:1,direction:"L2D"},{x:3,y:1,direction:"D2L"},{x:3,y:0,direction:"R2D"},{x:2,y:0,direction:"H"}],vx:1,vy:0},cookie={x:-1,y:-1},fpsCounter=0,moves=0,lastMoveWithDirChange=-1,bufferedDirChange=-1,alive=!0,gamePaused=!1,score=0,highScore=0,GRID={w:15,h:15},SPEED=7,COOKIE_SPAWN_RATE=10,CELL_SIZE=20,COOKIE_SIZE=8,COOKIE_PADDING=6,CANVAS_WIDTH=CELL_SIZE*GRID.w,CANVAS_HEIGHT=CELL_SIZE*GRID.h,SNAKE_COLOR="#3a3323",COOKIE_COLOR=
"#2160ff",BG_COLOR="#a2c000",isMobile=!1;
function setupScreenDimensions(){var a=window.innerWidth,b=window.innerHeight,c=document.getElementById("snake"),d=document.getElementById("dpad");highScore=0<localStorage["net.pretopia.SnakeIt.highScore"]?localStorage["net.pretopia.SnakeIt.highScore"]:0;CELL_SIZE=a<b?Math.floor(a/GRID.w):Math.floor(b/GRID.h);CANVAS_WIDTH=CELL_SIZE*GRID.w;CANVAS_HEIGHT=CELL_SIZE*GRID.h;COOKIE_SIZE=Math.floor(.4*CELL_SIZE);COOKIE_PADDING=Math.floor(CELL_SIZE-COOKIE_SIZE)/2;c.style.width=CANVAS_WIDTH+"px";if(isMobile=
/Android|webOS|iPhone|iPad|BlackBerry|Windows Phone|Opera Mini|IEMobile|Mobile/i.test(navigator.userAgent))document.body.ontouchmove=function(a){a.preventDefault()},d.style.display="block",d.style.width=CANVAS_WIDTH+"px",d.style.height=b-CANVAS_HEIGHT+"px",document.getElementById("up").style.height=(b-CANVAS_HEIGHT)/2+"px",document.getElementById("down").style.height=(b-CANVAS_HEIGHT)/2+"px"}
function setupCanvas(){canvas=document.createElement("canvas");canvas.width=CANVAS_WIDTH;canvas.height=CANVAS_HEIGHT;context=canvas.getContext("2d");document.getElementById("snake").appendChild(canvas)}function togglePauseGame(){gamePaused&&window.requestAnimationFrame(mainLoop);lastMoveWithDirChange=-1;gamePaused=!gamePaused}function gameOver(){lastMoveWithDirChange=-1;alive=!1;score>highScore&&(localStorage["net.pretopia.SnakeIt.highScore"]=score)}
function restartGame(){highScore=0<localStorage["net.pretopia.SnakeIt.highScore"]?localStorage["net.pretopia.SnakeIt.highScore"]:0;alive=!0;snake={tail:[{x:3,y:2,direction:"H"},{x:2,y:2,direction:"D2R"},{x:2,y:1,direction:"L2D"},{x:3,y:1,direction:"D2L"},{x:3,y:0,direction:"R2D"},{x:2,y:0,direction:"H"}],vx:1,vy:0};cookie={x:-1,y:-1};moves=score=fpsCounter=0;bufferedDirChange=lastMoveWithDirChange=-1;mainLoop()}
function handleKeyInput(a){if(lastMoveWithDirChange==moves)bufferedDirChange=a;else switch(lastMoveWithDirChange=moves,isMobile&&!alive&&restartGame(),a){case 27:alive?togglePauseGame():restartGame();break;case 38:0!=snake.vx&&(snake.tail[0].direction=1==snake.vx?"R2U":"L2U",snake.vx=0,snake.vy=-1);break;case 40:0!=snake.vx&&(snake.tail[0].direction=1==snake.vx?"R2D":"L2D",snake.vx=0,snake.vy=1);break;case 37:0!=snake.vy&&(snake.tail[0].direction=1==snake.vy?"D2L":"U2L",snake.vx=-1,snake.vy=0);break;
case 39:0!=snake.vy&&(snake.tail[0].direction=1==snake.vy?"D2R":"U2R",snake.vx=1,snake.vy=0)}}
function attachInputHandlers(){document.onkeydown=function(a){a=window.event?window.event.keyCode:a.which;(isMobile||alive&&!gamePaused||27==a)&&handleKeyInput(a)};document.getElementById("up").ontouchstart=function(){handleKeyInput(38)};document.getElementById("down").ontouchstart=function(){handleKeyInput(40)};document.getElementById("left").ontouchstart=function(){handleKeyInput(37)};document.getElementById("right").ontouchstart=function(){handleKeyInput(39)}}
function render(){context.fillStyle=BG_COLOR;context.fillRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT);context.fillStyle=COOKIE_COLOR;context.fillRect(CELL_SIZE*cookie.x+COOKIE_PADDING,CELL_SIZE*cookie.y+COOKIE_PADDING,COOKIE_SIZE,COOKIE_SIZE);context.fillStyle=SNAKE_COLOR;for(var a=0;a<snake.tail.length;a++)switch(snake.tail[a].direction){case "H":context.fillRect(CELL_SIZE*snake.tail[a].x,CELL_SIZE*snake.tail[a].y+1,CELL_SIZE,CELL_SIZE-2);break;case "V":context.fillRect(CELL_SIZE*snake.tail[a].x+1,CELL_SIZE*
snake.tail[a].y,CELL_SIZE-2,CELL_SIZE);break;case "R2D":case "U2L":context.fillRect(CELL_SIZE*snake.tail[a].x,CELL_SIZE*snake.tail[a].y+1,CELL_SIZE-1,CELL_SIZE-2);context.fillRect(CELL_SIZE*snake.tail[a].x+1,CELL_SIZE*snake.tail[a].y+CELL_SIZE-1,CELL_SIZE-2,1);break;case "R2U":case "D2L":context.fillRect(CELL_SIZE*snake.tail[a].x,CELL_SIZE*snake.tail[a].y+1,CELL_SIZE-1,CELL_SIZE-2);context.fillRect(CELL_SIZE*snake.tail[a].x+1,CELL_SIZE*snake.tail[a].y,CELL_SIZE-2,1);break;case "L2D":case "U2R":context.fillRect(CELL_SIZE*
snake.tail[a].x+1,CELL_SIZE*snake.tail[a].y+1,CELL_SIZE-1,CELL_SIZE-2);context.fillRect(CELL_SIZE*snake.tail[a].x+1,CELL_SIZE*snake.tail[a].y+CELL_SIZE-1,CELL_SIZE-2,1);break;case "L2U":case "D2R":context.fillRect(CELL_SIZE*snake.tail[a].x+1,CELL_SIZE*snake.tail[a].y+1,CELL_SIZE-1,CELL_SIZE-2),context.fillRect(CELL_SIZE*snake.tail[a].x+1,CELL_SIZE*snake.tail[a].y,CELL_SIZE-2,1)}context.fillStyle="#ffffff";context.textAlign="right";context.font="20px Arial";context.fillText(score,CANVAS_WIDTH-20,CANVAS_HEIGHT-
30);0<highScore&&(context.font="14px Arial",context.fillText("Best: "+highScore,CANVAS_WIDTH-20,CANVAS_HEIGHT-10));alive||(context.fillStyle="#ff0000",context.textAlign="center",context.font="36px Arial",context.fillText("GAME OVER",CANVAS_WIDTH/2,CANVAS_HEIGHT/2),isMobile||(context.font="18px Arial",context.fillText("ESC to restart",CANVAS_WIDTH/2,CANVAS_HEIGHT/2+30)))}
function bumpIntoSelf(){for(var a=snake.tail[0].x,b=snake.tail[0].y,c=1;c<snake.tail.length;c++)if(a==snake.tail[c].x&&b==snake.tail[c].y)return!0;return!1}function spawnCookie(){cookie.x=Math.floor(Math.random()*GRID.w);cookie.y=Math.floor(Math.random()*GRID.h);for(var a=0;a<snake.tail.length;a++)cookie.x==snake.tail[a].x&&cookie.y==snake.tail[a].y&&spawnCookie()}function eatCookie(){return snake.tail[0].x==cookie.x&&snake.tail[0].y==cookie.y}
function mainLoop(){var a=!1;!gamePaused&&alive&&window.requestAnimationFrame(mainLoop);if(0==fpsCounter%SPEED){fpsCounter=0;moves++;for(var b=snake.tail.length-1;0<=b;b--)if(0==b){snake.tail[0].x+=snake.vx;snake.tail[0].y+=snake.vy;switch(snake.tail[0].direction){case "R2D":case "R2U":case "L2D":case "L2U":snake.tail[0].direction="V";break;case "D2R":case "D2L":case "U2R":case "U2L":snake.tail[0].direction="H"}snake.tail[0].x>=GRID.w&&(snake.tail[0].x=0);0>snake.tail[0].x&&(snake.tail[0].x=GRID.w-
1);snake.tail[0].y>=GRID.h&&(snake.tail[0].y=0);0>snake.tail[0].y&&(snake.tail[0].y=GRID.h-1);eatCookie()&&(cookie.x=-1,cookie.y=-1,a=!0)}else snake.tail[b].x=snake.tail[b-1].x,snake.tail[b].y=snake.tail[b-1].y,snake.tail[b].direction=snake.tail[b-1].direction;bumpIntoSelf()&&gameOver();a&&(snake.tail[snake.tail.length]={x:snake.tail[0].x-snake.vx,y:snake.tail[0].y-snake.vy,direction:snake.tail[0].direction},score++);0<bufferedDirChange&&(handleKeyInput(bufferedDirChange),bufferedDirChange=-1);0==
moves%COOKIE_SPAWN_RATE&&0>cookie.x&&spawnCookie();render()}fpsCounter++}setupScreenDimensions();setupCanvas();attachInputHandlers();mainLoop();
